<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/roundSlider/1.6.1/roundslider.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/roundSlider/1.6.1/roundslider.min.js"></script>

<div style="display:flex; flex-direction:column; align-items:center; font-family:sans-serif; color:white;">
  <div style="font-size:16px; margin-bottom:6px;">{{TITLE}}</div>

  <!-- Runder Thermostat-Regler -->
  <div id="thermostat"></div>

  <!-- Zusatzinfos -->
  <div style="margin-top:12px; text-align:center; font-size:14px;">
    <div id="temperature">Ist: {{Temperature}} 째C</div>
    <div id="humidity">Luftfeuchte: {{Humidity}} %</div>
    <div id="mode">Modus: {{Mode}}</div>
  </div>
</div>

<script>
  // Initialer Regler mit Sollwert
  $("#thermostat").roundSlider({
    radius: 90,
    width: 15,
    min: 10,
    max: 30,
    step: 0.5,
    value: parseFloat("{{Setpoint}}"),
    circleShape: "pie",
    startAngle: 315,
    sliderType: "min-range",
    change: function (args) {
      // Sollwert zur체ck an Symcon senden
      sendToSymcon(JSON.stringify({ Setpoint: args.value }));
    }
  });

  // Handler f체r Updates aus PHP (UpdateVisualizationValue)
  function handleMessage(data) {
    var obj = JSON.parse(data);

    // Sollwert-Regler aktualisieren
    if (obj.Setpoint !== undefined) {
      $("#thermostat").data("roundSlider").setValue(obj.Setpoint);
    }
    if (obj.Temperature !== undefined) {
      document.getElementById("temperature").innerText = "Ist: " + obj.Temperature + " 째C";
    }
    if (obj.Humidity !== undefined) {
      document.getElementById("humidity").innerText = "Luftfeuchte: " + obj.Humidity + " %";
    }
    if (obj.Mode !== undefined) {
      document.getElementById("mode").innerText = "Modus: " + obj.Mode;
    }
  }

  // Symcon Bridge
  function sendToSymcon(message) {
    if (typeof window.external !== "undefined" && "send" in window.external) {
      window.external.send(message);
    }
  }
</script>
