<style>
:root {
  --ct-bg1: #4eacff;
  --ct-bg2: #214972;
  --ct-text: #fff;
  --ct-ring: rgba(255,255,255,0.3);
}

.ct-wrap {
  width:100%; height:100%;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  font-family: "Segoe UI", sans-serif;
  color: var(--ct-text);
}

.ct-circle {
  position:relative;
  width:220px; height:220px;
  border-radius:50%;
  background:linear-gradient(145deg,var(--ct-bg1),var(--ct-bg2));
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  box-shadow: 0 6px 20px rgba(0,0,0,0.4), inset 0 0 20px rgba(0,0,0,0.3);
  transition: box-shadow 0.2s ease-in-out;
}
.ct-circle:hover {
  box-shadow: 0 8px 25px rgba(0,0,0,0.6), inset 0 0 25px rgba(0,0,0,0.5);
}

.ct-ring {
  position:absolute;
  width:100%; height:100%;
  border-radius:50%;
  border:6px solid var(--ct-ring);
  top:0; left:0;
  box-sizing:border-box;
  pointer-events:none;
}

.ct-set {
  font-size:52px; font-weight:bold;
}
.ct-label {
  font-size:16px; margin-bottom:4px; opacity:0.8;
}
.ct-sub {
  margin-top:10px;
  font-size:14px;
  opacity:0.85;
}
.ct-small {
  margin-top:4px;
  font-size:12px;
  opacity:0.7;
}

.ct-controls {
  display:flex; gap:12px; margin-top:16px;
}
.ct-btn {
  width:46px; height:46px; border-radius:50%;
  background:#fff; color:var(--ct-bg2);
  border:none; font-size:20px; font-weight:bold;
  cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.25);
  transition: all 0.2s;
}
.ct-btn:hover {
  transform: scale(1.1);
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
}
.ct-input {
  width:70px; text-align:center; font-size:18px; font-weight:600;
  border-radius:8px; padding:6px; border:1px solid #ccc;
  color:#333;
}
</style>

<div class="ct-wrap">
  <div style="margin-bottom:8px;"><strong>{{Title}}</strong></div>

  <div class="ct-circle">
    <div class="ct-ring"></div>
    <div class="ct-label">Soll</div>
    <div id="SetPoint" class="ct-set">{{Setpoint}}째C</div>
    <div id="Temperature" class="ct-sub">Ist: {{Temperature}}째C</div>
    <div id="Humidity" class="ct-small">Luftfeuchte: {{Humidity}} %</div>
    <div id="Mode" class="ct-small">Modus: {{Mode}}</div>
  </div>

  <div class="ct-controls">
    <button id="btnDec" class="ct-btn">-</button>
    <input id="inputSetpoint" class="ct-input" value="{{Setpoint}}" />
    <button id="btnInc" class="ct-btn">+</button>
  </div>
</div>

<script>
function handleMessage(Data) {
    try {
        var obj = JSON.parse(Data);

        if ('Setpoint' in obj) {
            var sp = parseFloat(obj.Setpoint);
            document.getElementById('SetPoint').textContent = sp.toFixed(1) + "째C";
            var inp = document.getElementById('inputSetpoint');
            if (inp) inp.value = sp.toFixed(1);
        }
        if ('Temperature' in obj) {
            document.getElementById('Temperature').textContent = "Ist: " + parseFloat(obj.Temperature).toFixed(1) + "째C";
        }
        if ('Humidity' in obj) {
            document.getElementById('Humidity').textContent = "Luftfeuchte: " + parseFloat(obj.Humidity).toFixed(1) + " %";
        }
        if ('Mode' in obj) {
            document.getElementById('Mode').textContent = "Modus: " + obj.Mode;
        }
    } catch (e) {
        console.error("handleMessage parse error", e, Data);
    }
}

var instanceId = {{InstanceID}};

function sendAction(ident, value) {
    if (typeof IPS_RequestAction === 'function') {
        IPS_RequestAction(instanceId, ident, value);
    } else {
        console.warn('IPS_RequestAction not available', ident, value);
    }
}

document.getElementById('btnInc').addEventListener('click', function(){
    sendAction('inc', true);
});
document.getElementById('btnDec').addEventListener('click', function(){
    sendAction('dec', true);
});

var inp = document.getElementById('inputSetpoint');
inp.addEventListener('keydown', function(e){
    if (e.key === 'Enter') {
        var v = parseFloat(this.value);
        if (!isNaN(v)) sendAction('Setpoint', v);
    }
});
inp.addEventListener('focusout', function(){
    var v = parseFloat(this.value);
    if (!isNaN(v)) sendAction('Setpoint', v);
});
</script>
