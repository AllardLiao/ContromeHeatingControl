<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/roundSlider/1.6.1/roundslider.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/roundSlider/1.6.1/roundslider.min.js"></script>

<div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; font-family:sans-serif;">
  <div id="thermostat"></div>

  <div style="margin-top:12px; text-align:center; font-size:14px;">
    <div id="temperature">Ist: {{ Temperature }} °C</div>
    <div id="humidity">Luftfeuchte: {{ Humidity }} %</div>
    <div id="mode">Modus: {{ Mode }}</div>
  </div>
</div>

<script>
  // Initialisieren mit Solltemperatur
  $("#thermostat").roundSlider({
    radius: 90,
    width: 15,
    min: 10,
    max: 30,
    step: 0.5,
    value: {{ Setpoint }},
    circleShape: "pie",
    startAngle: 315,
    sliderType: "min-range",
    change: function (args) {
      sendToSymcon(JSON.stringify({ Setpoint: args.value }));
    }
  });

  // Dynamische Updates aus PHP
  function handleMessage(data) {
    var obj = JSON.parse(data);
    if (obj.Setpoint !== undefined) {
      $("#thermostat").data("roundSlider").setValue(obj.Setpoint);
    }
    if (obj.Temperature !== undefined) {
      document.getElementById("temperature").innerText = "Ist: " + obj.Temperature + " °C";
    }
    if (obj.Humidity !== undefined) {
      document.getElementById("humidity").innerText = "Luftfeuchte: " + obj.Humidity + " %";
    }
    if (obj.Mode !== undefined) {
      document.getElementById("mode").innerText = "Modus: " + obj.Mode;
    }
  }

  function sendToSymcon(message) {
    if (typeof window.external !== "undefined" && "send" in window.external) {
      window.external.send(message);
    }
  }
</script>
